# Jupyter Notebook 代理配置说明

在 Jupyter Notebook 中使用代理的完整指南。

## 快速开始

### 方法 1: 使用代理配置工具（推荐）

1. 在 notebook 的第一个 cell 中导入并使用：

```python
from proxy_config import set_local_proxy, print_proxy_config

# 设置本地代理（端口 7890）
set_local_proxy(7890)

# 查看当前配置
print_proxy_config()
```

### 方法 2: 直接设置环境变量

在 notebook 的第一个 cell 中：

```python
import os

os.environ['HTTP_PROXY'] = 'http://127.0.0.1:7890'
os.environ['HTTPS_PROXY'] = 'http://127.0.0.1:7890'
```

## 支持的代理类型

### HTTP/HTTPS 代理

```python
from proxy_config import set_proxy

set_proxy(
    http_proxy='http://127.0.0.1:7890',
    https_proxy='http://127.0.0.1:7890'
)
```

### SOCKS5 代理

需要先安装 `pysocks`：

```bash
pip install pysocks
```

然后设置：

```python
from proxy_config import set_socks5_proxy

set_socks5_proxy('127.0.0.1', 1080)
```

或者直接设置环境变量：

```python
import os
os.environ['HTTP_PROXY'] = 'socks5://127.0.0.1:1080'
os.environ['HTTPS_PROXY'] = 'socks5://127.0.0.1:1080'
```

### 带认证的代理

```python
from proxy_config import set_proxy

set_proxy(
    http_proxy='http://username:password@proxy.example.com:8080',
    https_proxy='http://username:password@proxy.example.com:8080'
)
```

## 在 ccxt 中配置代理

如果只想对特定的交易所使用代理：

```python
import ccxt

proxy_config = {
    'http': 'http://127.0.0.1:7890',
    'https': 'http://127.0.0.1:7890'
}

exchange = ccxt.binance({
    'proxies': proxy_config,
    'options': {
        'defaultType': 'spot'
    }
})
```

## 清除代理设置

```python
from proxy_config import unset_proxy

unset_proxy()
```

或者在新的 cell 中重启 kernel（Kernel -> Restart）。

## 验证代理是否生效

```python
import requests

# 测试代理是否工作
try:
    response = requests.get('https://httpbin.org/ip', timeout=10)
    print("代理状态:", response.json())
except Exception as e:
    print("代理可能未正确配置:", e)
```

## 常见问题

### 1. SOCKS5 代理不工作

确保已安装 `pysocks`：

```bash
pip install pysocks
```

### 2. 代理设置后仍然无法连接

- 检查代理地址和端口是否正确
- 确认代理服务正在运行
- 检查防火墙设置
- 尝试使用 `print_proxy_config()` 查看当前配置

### 3. 某些请求不需要代理

可以设置 `NO_PROXY` 环境变量：

```python
import os
os.environ['NO_PROXY'] = 'localhost,127.0.0.1,*.local'
```

## 在启动 Jupyter 时设置代理

也可以在启动 Jupyter 之前设置环境变量：

```bash
# 在终端中设置
export HTTP_PROXY=http://127.0.0.1:7890
export HTTPS_PROXY=http://127.0.0.1:7890

# 然后启动 Jupyter
jupyter notebook
```

或者在 Windows 中：

```cmd
set HTTP_PROXY=http://127.0.0.1:7890
set HTTPS_PROXY=http://127.0.0.1:7890
jupyter notebook
```

## 注意事项

1. **代理设置范围**：在 notebook 中设置的代理会影响该 notebook 的所有后续网络请求
2. **重启 Kernel**：如果代理设置有问题，可以重启 kernel 清除设置
3. **代理地址格式**：
   - HTTP: `http://host:port`
   - HTTPS: `https://host:port` 或 `http://host:port`
   - SOCKS5: `socks5://host:port`
   - 带认证: `http://username:password@host:port`
4. **性能影响**：使用代理可能会影响请求速度，请根据实际情况选择

